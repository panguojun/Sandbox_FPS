using UnityEngine;using System.Collections;using System;using System.Runtime.InteropServices;// --------------------------------// libPMDLL// --------------------------------public class libPMDLL{#if UNITY_IOS	[DllImport("__Internal")]#else    [DllImport("libPMDLL")]#endif    public static extern int start();#if UNITY_IOS	[DllImport("__Internal")]#else    [DllImport("libPMDLL")]#endif    public static extern void getdat(int[] dat);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID     [DllImport("PMDLL")]#else    [DllImport("libPMDLL")]#endif    public static extern int getpoints(int id, int dat, Vector3[] pt, Color32[] cor, float[] sz, int cnt, int entind);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void onevent (int id, int key, float x, float y);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void updatecolor(float[] pos, uint cor);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern bool createmesh(int type, int dat, Vector3 worldpos, int crttype, int entindex);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    private static extern int getVcnt();#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    private static extern bool getVdata(Vector3[] v);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    private static extern bool setVdata(Vector3[] v, int cnt);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    private static extern bool getNorm(Vector3[] v);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    private static extern bool getCdata(Color32[] c);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    private static extern int getTcnt();#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    private static extern bool getTdata(int[] v);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    private static extern bool setTdata(int[] v, int cnt);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    private static extern bool getUVdata(Vector2[] v);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern int getgamelevel();#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern int getgamestate();#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern int getcamstate();#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void setcampos (float x, float y, float z);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void getplayerpos(float[] pos);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void setplayerpos(float[] pos, bool ishit);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern int getsceneobjnum();#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void getsceneobjdat(int[] ids, Vector3[] p, Vector3[] v, Vector3[] e, float[] s, int[] stat);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void getobjtrans (int ind, Vector3[] trans);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern int getintdat (int index);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void setintdat(int index, int val);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern bool getcampos(float[] pos);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern int getitemnum();#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void getitems(int[] items);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern bool getbillboard(int id, int subid, int entindex, int[] dat);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void screensize(float w, float h);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern int windowstate(int id);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void onbutton(int id);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void pickitem(int ind);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void onpickobj(int id, float[] hitpos, int triindex);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void setframetime(float dtime);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern bool getdragenhead(float[] o, float[] v, float[] up);	#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void addmat(int type);	#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern void setdanlu(int index, float danludat);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else     [DllImport("libPMDLL")]#endif    public static extern bool getchengdan(int[] dandat);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else    [DllImport("libPMDLL")]#endif    public static extern bool getdantrans(int index, float[] trans);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else    [DllImport("libPMDLL")]#endif    public static extern bool getdaninfo(int index, int[] dat);#if UNITY_IOS	[DllImport("__Internal")]#elif UNITY_ANDROID    [DllImport("PMDLL")]#else    [DllImport("libPMDLL")]#endif    public static extern int getdannum();    // --------------------------------    public static bool getCppVdata(Mesh m)	{		int sz = getVcnt();		if (sz == 0)			return false;		// Debug.Log("getCppVdata: " + sz.ToString());		Vector3[] dat = new Vector3[sz];		if(getVdata(dat))		{			m.vertices = dat;			return true;		}		return false;	}    // --------------------------------    public static void setCppVdata(Mesh m)    {		Debug.Log (m.vertices.Length);        setVdata(m.vertices, m.vertices.Length);    }    // --------------------------------    public static bool getCppNdata(Mesh m)	{		int sz = getVcnt();		if (sz == 0)			return false;		// Debug.Log("getCppNdata: " + sz.ToString());		Vector3[] dat = new Vector3[sz];		if(getNorm(dat))		{			m.normals = dat;			return true;		}		return false;	}	// --------------------------------	public static bool getCppCdata(Mesh m)	{		int sz = getVcnt();		if (sz == 0)			return false;		// Debug.Log("getCppCdata: " + sz.ToString());		Color32[] dat = new Color32[sz];		if (getCdata(dat))		{			m.colors32 = dat;			return true;		}		return false;	}	public static bool getCppTdata(Mesh m)	{		int sz = getTcnt();		// Debug.Log("getCppTdata: " + sz.ToString());		int[] dat = new int[sz];		if (getTdata(dat))		{			m.triangles = dat;			return true;		}		return false;	}    public static void setCppTdata(Mesh m)    {        setTdata(m.triangles,m.triangles.Length);    }    public static bool getCppUVdata(Mesh m)    {        int sz = getVcnt();        {            Vector2[] dat = new Vector2[sz];            if (getUVdata(dat))            {                m.uv = dat;                m.uv2 = dat;                return true;            }        }        return false;    }    public static void setMeshData(GameObject go)    {		MeshFilter mf = go.GetComponent<MeshFilter>();        setCppVdata(mf.mesh);        setCppTdata(mf.mesh);    }    public static bool updateMesh(Mesh m, bool isupdatenors = true)	{		m.Clear();		if (!getCppVdata(m))			return false;		//if (!getCppNdata(m))		//	return false;				if (!getCppCdata(m))			return false;		if (!getCppTdata(m))			return false;        if (!getCppUVdata(m))            return false;		//if (isupdatenors) {			m.RecalculateBounds ();			m.RecalculateNormals ();            m.RecalculateTangents();		//}		return true;	}	public static bool createMesh(GameObject go, int type, int entindex, int dat = 0, int crttype = 0)	{		//Debug.Log("createMesh£º " + go.name);		MeshFilter mf = go.GetComponent<MeshFilter>();		if (!createmesh (type, dat, go.transform.position, crttype, entindex))		{			if(crttype == 0)				go.SetActive (false);			return false;		}		return updateMesh(mf.mesh);	}}